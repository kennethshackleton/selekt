name: 'Continous Integration'

on:
  pull_request:
  push:
    branches-ignore:
      - 'main'

jobs:
  build-container:
    name: 'Build container'
    runs-on: ubuntu-latest
    steps:
    - name: 'Install Build Tools'
      run: echo 'y' | sudo ${ANDROID_HOME}/tools/bin/sdkmanager --install 'build-tools;30.0.0'
    - name: 'Install CMake'
      run: echo 'y' | sudo ${ANDROID_HOME}/tools/bin/sdkmanager --install 'cmake;3.10.2.4988404'
    - name: 'Install NDK'
      run: echo 'y' | sudo ${ANDROID_HOME}/tools/bin/sdkmanager --install 'ndk;21.3.6528147'
    - name: 'Install Android SDK'
      run: echo 'y' | sudo ${ANDROID_HOME}/tools/bin/sdkmanager --install 'platforms;android-30'
  lint:
    name: 'Lint'
    needs: build-container
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - name: 'Configure local.propertiess'
      run: echo "sdk.dir=${ANDROID_HOME}" > local.properties && echo "ndk.dir=${ANDROID_HOME}/ndk/21.3.6528147" >> local.properties
    - name: 'Ktlint'
      run: ./gradlew --no-daemon ktlint
  build-artifacts:
    name: 'Build artifacts'
    needs: build-container
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - name: 'Configure local.propertiess'
      run: echo "sdk.dir=${ANDROID_HOME}" > local.properties && echo "ndk.dir=${ANDROID_HOME}/ndk/21.3.6528147" >> local.properties
    - name: 'Assemble Selekt'
      run: ./gradlew --no-daemon assembleSelekt
